å®ç°Instagramçš„Material Designæ¦‚å¿µè®¾è®¡
---

>
* åŸæ–‡é“¾æ¥:[Instagram with Material Design concept is getting real ](http://frogermcs.github.io/Instagram-with-Material-Design-concept-is-getting-real/)
* è¯‘è€… :  [jianghejie](https://github.com/jianghejie) 
* è¯‘è€…åšæ–‡é“¾æ¥ :  [jcodecraeer.com](http://jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0204/2415.html)
 
å‡ ä¸ªæœˆå‰ï¼ˆè¿™ç¯‡æ–‡ç« çš„æ—¥æœŸæ˜¯2014 å¹´11æœˆ10æ—¥ï¼‰ï¼Œgoogleå‘å¸ƒäº†appå’Œwebåº”ç”¨çš„Material Designè®¾è®¡å‡†åˆ™ä¹‹åï¼Œè®¾è®¡å¸ˆEmmanuel Pacamalanåœ¨youtubeä¸Šå‘å¸ƒäº†ä¸€åˆ™æ¦‚å¿µè§†é¢‘ï¼Œæ¼”ç¤ºäº†Instagramå¦‚æœåšæˆMaterialé£æ ¼ä¼šæ˜¯ä»€ä¹ˆæ ·å­ï¼š

è§†é¢‘åœ°å€åœ¨è¿™é‡Œ [http://v.youku.com/v_show/id_XODg2NDQ1NDQ4.html](http://v.youku.com/v_show/id_XODg2NDQ1NDQ4.html) ps:markdownä¸æ”¯æŒæ’­æ”¾ä¼˜é…·è§†é¢‘

è¿™ ä»…ä»…æ˜¯åœç•™åœ¨å›¾åƒä¸Šçš„è®¾è®¡ï¼Œæ˜¯ç¾å¥½çš„æ„¿æ™¯ï¼Œä¼°è®¡å¾ˆå¤šäººéƒ½ä¼šé—®ï¼Œèƒ½å¦ä½¿ç”¨ç›¸å¯¹ç®€å•çš„åŠæ³•å°†å®ƒå®ç°å‡ºæ¥å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼šyesï¼Œä¸ä»…ä»…èƒ½å®ç°ï¼Œè€Œä¸”æ— é¡»è¦æ±‚åœ¨ Lillipopç‰ˆæœ¬ï¼Œå®é™…ä¸Šå‡ å¹´å‰4.0å‘å¸ƒä¹‹åæˆ‘ä»¬å°±å¯ä»¥å®ç°è¿™äº›æ•ˆæœäº†ã€‚ps è¯»åˆ°è¿™é‡Œæˆ‘ä»¬åº”è¯¥åæ€è¿™å‡ å¹´å¼€å‘è€…æ˜¯ä¸æ˜¯éƒ½åƒå±å»äº†ã€‚

é‰´äºè¿™ä¸ªåŸå› ï¼Œæˆ‘å†³å®šå¼€å§‹æ’°å†™ä¸€ä¸ªæ–°çš„è¯¾é¢˜-å¦‚ä½•å°†[INSTAGRAM with Material Design](https://www.youtube.com/watch?v=ojwdmgmdR_Q) è§†é¢‘ä¸­çš„æ•ˆæœè½¬å˜æˆç°å®ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬å¹¶ä¸æ˜¯çœŸçš„è¦åšä¸€ä¸ªInstagramåº”ç”¨ï¼Œåªæ˜¯å°†ç•Œé¢åšå‡ºæ¥è€Œå·²ï¼Œå¹¶ä¸”å°½é‡å‡å°‘ä¸€äº›ä¸å¿…è¦çš„ç»†èŠ‚ã€‚
##å¼€å§‹

æœ¬æ–‡å°†è¦å®ç°çš„æ˜¯è§†é¢‘ä¸­å‰7ç§’é’Ÿçš„æ•ˆæœã€‚æˆ‘è§‰å¾—å¯¹äºç¬¬ä¸€æ¬¡å°è¯•æ¥è¯´å·²ç»è¶³å¤Ÿäº†ã€‚æˆ‘æƒ³è¦æé†’è¯¸ä½çš„æ˜¯ï¼Œé‡Œé¢çš„å®ç°æ–¹æ³•ä¸ä»…ä»…æ˜¯èƒ½å®ç°ï¼Œä¹Ÿæ˜¯æˆ‘ä¸ªäººæœ€å–œæ¬¢çš„å®ç°æ–¹å¼ã€‚è¿˜æœ‰ï¼Œæˆ‘ä¸æ˜¯ä¸€ä¸ªç¾å·¥ï¼Œå› æ­¤é¡¹ç›®ä¸­çš„æ‰€æœ‰å›¾ç‰‡æ˜¯ç›´æ¥ä»ç½‘ä¸Šå…¬å¼€çš„æ¸ é“è·å–çš„ã€‚ï¼ˆä¸»è¦æ˜¯ä»   [resources page](http://www.google.com/design/spec/resources/sticker-sheets-icons.html) ï¼‰ã€‚

å¥½äº†ï¼Œä¸‹é¢æ˜¯æœ€ç»ˆæ•ˆæœçš„ä¸¤ç»„æˆªå›¾å’Œè§†é¢‘ï¼ˆå¾ˆçŸ­çš„è§†é¢‘ï¼Œå°±æ˜¯é‚£7ç§’é’Ÿçš„æ•ˆæœï¼Œå¯ä»¥åœ¨ä¸Šé¢çš„è§†é¢‘ä¸­çœ‹åˆ°ï¼Œè¿™é‡Œå› ä¸ºæ²¡æ³•ç›´æ¥å¼•ç”¨youtubeçš„è§†é¢‘å°±ç•¥äº†ï¼‰ï¼ˆåˆ†åˆ«ä»Android 4 å’Œ5ä¸Šè·å¾—çš„ï¼‰ï¼š

![](http://jcodecraeer.com/uploads/20150204/1423058817102389.png)

![](http://jcodecraeer.com/uploads/20150204/1423059082492283.png)


##å‡†å¤‡
åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œå°†ä½¿ç”¨ä¸€äº›çƒ­é—¨çš„androidå¼€å‘å·¥å…·å’Œåº“ã€‚å¹¶ä¸æ˜¯æ‰€æœ‰è¿™äº›ä¸œè¥¿æœ¬ç¯‡æ–‡ç« éƒ½ä¼šç”¨åˆ°ï¼Œæˆ‘åªæ˜¯å°†å®ƒä»¬å‡†å¤‡å¥½ä»¥å¤‡ä¸æ—¶ä¹‹éœ€ã€‚
åˆå§‹åŒ–é¡¹ç›®

é¦–å…ˆæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„androidé¡¹ç›®ã€‚æˆ‘ä½¿ç”¨çš„æ˜¯Android Studioå’Œgradleçš„buildæ–¹å¼ã€‚æœ€ä½ç‰ˆæœ¬çš„sdkæ˜¯15ï¼ˆå³Android 4.0.4ï¼‰ã€‚ç„¶åæˆ‘ä»¬å°†æ·»åŠ ä¸€äº›ä¾èµ–ã€‚æ²¡ä»€ä¹ˆå¥½è®²çš„ï¼Œä¸‹é¢æ˜¯build.gradleä»¥åŠapp/build.gradleæ–‡ä»¶çš„ä»£ç ï¼š

build.gradle
```gradle
buildscript {
    repositories {
        jcenter()
    }
    dependencies {
        classpath 'com.android.tools.build:gradle:0.14.0'
        classpath 'com.jakewharton.hugo:hugo-plugin:1.1.+'
    }
}
  
allprojects {
    repositories {
        jcenter()
    }
}
```
app/build.gradle
```gradle
apply plugin: 'com.android.application'
apply plugin: 'hugo'
  
android {
    compileSdkVersion 21
    buildToolsVersion "21.1"
      
    defaultConfig {
        applicationId "io.github.froger.instamaterial"
        minSdkVersion 15
        targetSdkVersion 21
        versionCode 1
        versionName "1.0"
    }
}
  
dependencies {
    compile fileTree(dir: 'libs', include: ['*.jar'])
      
    compile "com.android.support:appcompat-v7:21.0.0"
    compile 'com.android.support:support-v13:21.+'
    compile 'com.android.support:support-v4:21.+'
    compile 'com.android.support:palette-v7:+'
    compile 'com.android.support:recyclerview-v7:+'
    compile 'com.android.support:cardview-v7:21.0.+'
    compile 'com.jakewharton:butterknife:5.1.2'
    compile 'com.jakewharton.timber:timber:2.5.0'
    compile 'com.facebook.rebound:rebound:0.3.6'
}
```

ç®€è€Œè¨€ä¹‹ï¼Œæˆ‘ä»¬æœ‰å¦‚ä¸‹å·¥å…·ï¼š

ä¸€äº›å…¼å®¹åŒ…ï¼ˆCardView, RecyclerView, Palette, AppCompatï¼‰-æˆ‘å–œæ¬¢ä½¿ç”¨æœ€æ–°çš„æ§ä»¶ã€‚å½“ç„¶ä½ å®Œå…¨å¯ä»¥ä½¿ç”¨ListView Actionbarç”šè‡³View/FrameViewæ¥æ›¿ä»£ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆæŠ˜è…¾ï¼ŸğŸ˜‰

[ButterKnife](http://jakewharton.github.io/butterknife/) - viewæ³¨å…¥å·¥å…·ç®€åŒ–æˆ‘ä»¬çš„ä»£ç ã€‚ï¼ˆæ¯”æ–¹è¯´ä¸å†éœ€è¦å†™findViewById()æ¥å¼•ç”¨viewï¼Œä»¥åŠä¸€äº›æ›´å¼ºå¤§çš„åŠŸèƒ½ï¼‰ã€‚

[Rebound](http://facebook.github.io/rebound/)  - æˆ‘ä»¬ç›®å‰è¿˜æ²¡æœ‰ç”¨åˆ°ï¼Œä½†æ˜¯æˆ‘ä»¥åè‚¯å®šä¼šç”¨å®ƒã€‚è¿™ä¸ªfacebookå¼€å‘çš„åŠ¨ç”»åº“å¯ä»¥è®©ä½ çš„åŠ¨ç”»æ•ˆæœçœ‹èµ·æ¥æ›´è‡ªç„¶ã€‚

[Timber](https://github.com/JakeWharton/timber)  å’Œ [Hugo](https://github.com/JakeWharton/hugo)   - å¯¹è¿™ä¸ªé¡¹ç›®è€Œè¨€å¹¶ä¸æ˜¯å¿…é¡»ï¼Œæˆ‘ä»…ä»…æ˜¯ç”¨ä»–ä»¬æ‰“å°logã€‚

##å›¾ç‰‡èµ„æº

æœ¬é¡¹ç›®ä¸­å°†ä½¿ç”¨åˆ°ä¸€äº›Material Designçš„å›¾æ ‡èµ„æºã€‚App å›¾æ ‡æ¥è‡ªäº [NSTAGRAM with Material Design](https://www.youtube.com/watch?v=ojwdmgmdR_Q) è§†é¢‘ï¼Œ[è¿™é‡Œ](https://github.com/frogermcs/frogermcs.github.io/raw/master/files/2/resources.zip)  æ˜¯é¡¹ç›®çš„å…¨å¥—èµ„æºã€‚
##æ ·å¼

æˆ‘ä»¬ä»å®šä¹‰appçš„é»˜è®¤æ ·å¼å¼€å§‹ã€‚åŒæ—¶ä¸ºAndroid 4å’Œ5å®šä¹‰Material Desingæ ·å¼çš„æœ€ç®€å•çš„æ–¹å¼æ˜¯ç›´æ¥ç»§æ‰¿Theme.AppCompat.NoActionBar æˆ–è€… Theme.AppCompat.Light.NoActionBarä¸»é¢˜ã€‚ä¸ºä»€ä¹ˆæ˜¯NoActionBarï¼Ÿå› ä¸ºæ–°çš„sdkä¸­ä¸ºæˆ‘ä»¬æä¾›äº†å®ç°ActionbaråŠŸèƒ½çš„æ–°æ¨¡å¼ã€‚æœ¬ä¾‹ä¸­æˆ‘ä»¬å°†ä½¿ç”¨Toolbaræ§ä»¶ï¼ŒåŸºäºè¿™ä¸ªåŸå› -Toolbaræ˜¯ActionBaræ›´å¥½æ›´çµæ´»çš„è§£å†³æ–¹æ¡ˆã€‚æˆ‘ä»¬ä¸ä¼šæ·±å…¥è®²è§£è¿™ä¸ªé—®é¢˜ï¼Œä½†ä½ å¯ä»¥å»é˜…è¯»androidå¼€å‘è€…åšå®¢[AppCompat v21](http://android-developers.blogspot.com/2014/10/appcompat-v21-material-design-for-pre.html)  ã€‚


æ ¹æ®æ¦‚å¿µè§†é¢‘ä¸­çš„æ•ˆæœï¼Œæˆ‘ä»¬åœ¨AppThemeä¸­å®šä¹‰äº†ä¸‰ä¸ªåŸºæœ¬é¢œè‰²ï¼ˆåŸºè‰²è°ƒï¼‰ï¼š

styles.xml
```xml
<?xml version="1.0" encoding="utf-8"?>
<!-- styles.xml-->
<resources>
    <style name="AppTheme" parent="Theme.AppCompat.Light.NoActionBar">
        <item name="colorPrimary">@color/style_color_primary</item>
        <item name="colorPrimaryDark">@color/style_color_primary_dark</item>
        <item name="colorAccent">@color/style_color_accent</item>
    </style>
</resources>
```
colors1.xml
```xml
<?xml version="1.0" encoding="utf-8"?>
<!--colors.xml-->
<resources>
    <color name="style_color_primary">#2d5d82</color>
    <color name="style_color_primary_dark">#21425d</color>
    <color name="style_color_accent">#01bcd5</color>
</resources>
```
å…³äºè¿™ä¸‰ä¸ªé¢œè‰²çš„æ„ä¹‰ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°Material [Theme Color Palette documentation](http://developer.android.com/training/material/theme.html#ColorPalette) ã€‚ 
##å¸ƒå±€
é¡¹ç›®ç›®å‰ä¸»è¦ä½¿ç”¨äº†3ä¸ªä¸»è¦çš„å¸ƒå±€å…ƒç´ 

    *Toolbar* - åŒ…å«å¯¼èˆªå›¾æ ‡å’Œapplogoçš„é¡¶éƒ¨bar

    *TRecyclerView*T - ç”¨äºæ˜¾ç¤ºfeed

    *TFloating Action Button* - ä¸€ä¸ªå®ç°äº†Material Designä¸­[action button pattern](http://www.google.com/design/spec/components/buttons.html#buttons-flat-raised-buttons)çš„ImageButtonã€‚

åœ¨å¼€å§‹å®ç°å¸ƒå±€ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆåœ¨res/values/dimens.xmlæ–‡ä»¶ä¸­å®šä¹‰ä¸€äº›é»˜è®¤å€¼ï¼š
```xml
<?xml version="1.0" encoding="utf-8"?>
<!--dimens.xml-->
<resources>
    <dimen name="btn_fab_size">56dp</dimen>
    <dimen name="btn_fab_margins">16dp</dimen>
    <dimen name="default_elevation">8dp</dimen>
</resources>
```
è¿™äº›å€¼çš„å¤§å°æ˜¯åŸºäºMaterial Designè®¾è®¡å‡†åˆ™ä¸­çš„ä»‹ç»ã€‚

ç°åœ¨æˆ‘ä»¬æ¥å®ç°MainActivityä¸­çš„layoutï¼š

activity_main.xml
```xml
<RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:id="@+id/root"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    tools:context=".MainActivity">
  
    <android.support.v7.widget.Toolbar
        android:id="@+id/toolbar"
        android:layout_width="match_parent"
        android:layout_height="?attr/actionBarSize"
        android:background="?attr/colorPrimary">
      
        <ImageView
            android:id="@+id/ivLogo"
            android:layout_width="match_parent"
            android:layout_height="match_parent"
            android:layout_gravity="center"
            android:scaleType="center"
            android:src="@drawable/img_toolbar_logo" />
    </android.support.v7.widget.Toolbar>
      
    <android.support.v7.widget.RecyclerView
        android:id="@+id/rvFeed"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:layout_below="@id/toolbar"
        android:scrollbars="none" />
      
    <ImageButton
        android:id="@+id/btnCreate"
        android:layout_width="@dimen/btn_fab_size"
        android:layout_height="@dimen/btn_fab_size"
        android:layout_alignParentBottom="true"
        android:layout_alignParentRight="true"
        android:layout_marginBottom="@dimen/btn_fab_margins"
        android:layout_marginRight="@dimen/btn_fab_margins"
        android:background="@drawable/btn_fab_default"
        android:elevation="@dimen/default_elevation"
        android:src="@drawable/ic_instagram_white"
        android:textSize="28sp" />
  
</RelativeLayout>
```
ä»¥ä¸Šä»£ç çš„è§£é‡Š:

    å…³äºToolbaræœ€é‡è¦çš„ç‰¹å¾æ˜¯ä»–ç°åœ¨æ˜¯activity layoutçš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸”ç»§æ‰¿è‡ªViewGroupï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨é‡Œé¢æ”¾ä¸€äº›UIå…ƒç´ ï¼ˆå®ƒä»¬å°†åˆ©ç”¨å‰©ä½™ç©ºé—´ï¼‰ã€‚æœ¬ä¾‹ä¸­ï¼Œå®ƒè¢«ç”¨æ¥æ”¾ç½®logoå›¾ç‰‡ã€‚åŒæ—¶ï¼Œå› ä¸ºToolbaræ˜¯æ¯”Actionbaræ›´çµæ´»çš„æ§ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰æ›´å¤šçš„ä¸œè¥¿ï¼Œæ¯”å¦‚è®¾ç½®èƒŒæ™¯é¢œè‰²ä¸ºcolorPrimaryï¼ˆå¦åˆ™Toolbarå°†æ˜¯é€æ˜çš„ï¼‰ã€‚

    RecyclerViewè™½ç„¶åœ¨xmlä¸­ç”¨èµ·æ¥éå¸¸ç®€å•ï¼Œä½†æ˜¯å¦‚æœjavaä»£ç ä¸­æ²¡æœ‰è®¾ç½®æ­£ç¡®ï¼Œappæ˜¯ä¸èƒ½å¯åŠ¨çš„ï¼Œä¼šæŠ¥java.lang.NullPointerExceptionã€‚


    Elevationï¼ˆImageButtonä¸­ï¼‰å±æ€§ä¸å…¼å®¹api21ä»¥å‰çš„ç‰ˆæœ¬ã€‚æ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³åšåˆ°Floating Action Buttonçš„æ•ˆæœéœ€è¦åœ¨Lollipopå’ŒLollipopä¹‹å‰çš„è®¾å¤‡ä¸Šä½¿ç”¨ä¸åŒçš„backgroundã€‚

*Floating Action Button*

ä¸ºäº†ç®€åŒ–FABçš„ä½¿ç”¨ï¼Œæˆ‘ä»¬å°†ç”¨å¯¹Lollipopä»¥åŠLollipopä¹‹å‰çš„è®¾å¤‡ä½¿ç”¨ä¸åŒçš„æ ·å¼ï¼š

*FAB for Android v21:*

![](http://jcodecraeer.com/uploads/20150204/1423059083822681.png)

*FAB for Android pre-21:*

![](http://jcodecraeer.com/uploads/20150204/1423059084110006.png)

æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸¤ä¸ªä¸åŒçš„xmlæ–‡ä»¶æ¥è®¾ç½®buttonçš„backgroundï¼š/res/drawable-v21/btn_fab_default.xmlï¼ˆLollipopè®¾å¤‡ï¼‰ ï¼Œ/res/drawable/btn_fab_default.xmlï¼ˆLollipopä¹‹å‰çš„è®¾å¤‡ï¼‰ï¼š

btn_fab_default2.xml
```xml
<?xml version="1.0" encoding="utf-8"?>
<!--drawable-v21/btn_fab_default.xml-->
<ripple xmlns:android="http://schemas.android.com/apk/res/android"
    android:color="@color/fab_color_shadow">
    <item>
    <shape android:shape="oval">
    <solid android:color="@color/style_color_accent" />
    </shape>
    </item>
</ripple>
```
btn_fab_default1.xml
```xml
<?xml version="1.0" encoding="utf-8"?>
<!--drawable/btn_fab_default.xml-->
<selector xmlns:android="http://schemas.android.com/apk/res/android">
    <item android:state_pressed="false">
        <layer-list>
            <item android:bottom="0dp" android:left="2dp" android:right="2dp" android:top="2dp">
                <shape android:shape="oval">
                    <solid android:color="@color/fab_color_shadow" />
                </shape>
            </item>
              
            <item android:bottom="2dp" android:left="2dp" android:right="2dp" android:top="2dp">
                <shape android:shape="oval">
                    <solid android:color="@color/style_color_accent" />
                </shape>
            </item>
        </layer-list>
    </item>
    <item android:state_pressed="true">
        <shape android:bottom="2dp" android:left="2dp" android:right="2dp" android:shape="oval" android:top="2dp">
        <solid android:color="@color/fab_color_pressed" />
        </shape>
    </item>
</selector>
```
ä¸Šé¢çš„ä»£ç æ¶‰åŠåˆ°ä¸¤ä¸ªé¢œè‰²çš„å®šä¹‰,åœ¨res/values/colors.xmlä¸­æ·»åŠ ï¼š
```xml
<color name="btn_default_light_normal">#00000000</color>
<color name="btn_default_light_pressed">#40ffffff</color>
```
å¯ä»¥çœ‹åˆ°åœ¨ 21ä¹‹å‰çš„è®¾å¤‡å•†åˆ¶é€ é˜´å½±æ¯”è¾ƒå¤æ‚ã€‚ä¸å¹¸çš„æ˜¯åœ¨xmlä¸­è¾¾åˆ°çœŸå®çš„é˜´å½±æ•ˆæœæ²¡æœ‰æ¸å˜æ–¹æ³•ã€‚å…¶ä»–çš„åŠæ³•æ˜¯ä½¿ç”¨å›¾ç‰‡çš„æ–¹å¼ï¼Œæˆ–è€…é€šè¿‡javaä»£ç å®ç°ï¼ˆå‚è§[creating fab shadow](http://stackoverflow.com/questions/24480425/android-l-fab-button-shadow)ï¼‰ã€‚
##Toolbar

ç°åœ¨æˆ‘ä»¬æ¥å®ŒæˆToolbarã€‚æˆ‘ä»¬å·²ç»æœ‰äº†backgroundå’Œåº”ç”¨çš„logoï¼Œç°åœ¨è¿˜å‰©ä¸‹navigationä»¥åŠmenuèœå•å›¾æ ‡äº†ã€‚å…³äºnavigationï¼Œéå¸¸ä¸å¹¸çš„æ˜¯ï¼Œåœ¨xmlä¸­app:navigationIcon=""æ˜¯ä¸èµ·ä½œç”¨çš„ï¼Œè€Œandroid:navigationIcon=""åˆåªèƒ½åœ¨Lollipopä¸Šæœ‰ç”¨ï¼Œæ‰€ä»¥åªèƒ½ä½¿ç”¨ä»£ç çš„æ–¹å¼äº†ï¼š
```xml
toolbar.setNavigationIcon(R.drawable.ic_menu_white);
```
æ³¨ï¼šapp:navigationIcon=""çš„æ„æ€æ˜¯ä½¿ç”¨å…¼å®¹åŒ…appcompatçš„å±æ€§ï¼Œè€Œandroid:navigationIcon=""æ˜¯æ ‡å‡†çš„sdkå±æ€§ã€‚

è‡³äºmenuå›¾æ ‡æˆ‘ä»¬ä½¿ç”¨æ ‡å‡†çš„å®šä¹‰æ–¹å¼å°±å¥½äº†ï¼š

åœ¨res/menu/menu_main.xmlä¸­
```xml
<!--menu_main.xml-->
<menu xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    tools:context=".MainActivity">
        <item
            android:id="@+id/action_inbox"
            android:icon="@drawable/ic_inbox_white"
            android:title="Inbox"
            app:showAsAction="always" />
</menu>
```
åœ¨activityä¸­inflatedè¿™ä¸ªmenuï¼š
```java
@Override
public boolean onCreateOptionsMenu(Menu menu) {
    getMenuInflater().inflate(R.menu.menu_main, menu);
    return true;
}
```
æœ¬åº”è¿è¡Œçš„å¾ˆå¥½ï¼Œä½†æ˜¯æ­£å¦‚æˆ‘åœ¨twitterä¸Šæåˆ°çš„ï¼ŒToolbar onClick  selectorsæœ‰ä¸åè°ƒçš„æƒ…å†µï¼š


ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦åšæ›´å¤šçš„å·¥ä½œï¼Œé¦–å…ˆä¸ºmenu itemåˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„view

res/layout/menu_item_view.xmlï¼š
```xml
<?xml version="1.0" encoding="utf-8"?>
<!--menu_item_view.xml-->
<ImageButton xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="?attr/actionBarSize"
    android:layout_height="?attr/actionBarSize"
    android:background="@drawable/btn_default_light"
    android:src="@drawable/ic_inbox_white" />
```
ç„¶åä¸ºLollipopå’ŒLollipopä¹‹å‰çš„è®¾å¤‡åˆ†åˆ«åˆ›å»ºonClickçš„selectorï¼Œåœ¨Lollipopä¸Šæœ‰rippleæ•ˆæœï¼š
btn_default_light2.xml
```xml
<?xml version="1.0" encoding="utf-8"?>
<!--drawable-v21/btn_default_light.xml-->
<ripple xmlns:android="http://schemas.android.com/apk/res/android"
    android:color="@color/btn_default_light_pressed" />
```
btn_default_light1.xml
```xml
<?xml version="1.0" encoding="utf-8"?>
<!--drawable/btn_default_light.xml-->
<selector xmlns:android="http://schemas.android.com/apk/res/android">
    <item android:drawable="@color/btn_default_light_normal" android:state_focused="false" android:state_pressed="false" />
    <item android:drawable="@color/btn_default_light_pressed" android:state_pressed="true" />
    <item android:drawable="@color/btn_default_light_pressed" android:state_focused="true" />
</selector>
```
ç°åœ¨ï¼Œå·¥ç¨‹ä¸­çš„æ‰€æœ‰çš„coloråº”è¯¥æ˜¯è¿™æ ·å­äº†ï¼š

colors.xml   
```xml
<?xml version="1.0" encoding="utf-8"?>
<!--colors.xml-->
<resources>
<color name="style_color_primary">#2d5d82</color>
<color name="style_color_primary_dark">#21425d</color>
<color name="style_color_accent">#01bcd5</color>
  
<color name="fab_color_pressed">#007787</color>
<color name="fab_color_shadow">#44000000</color>
  
<color name="btn_default_light_normal">#00000000</color>
<color name="btn_default_light_pressed">#40ffffff</color>
</resources>
```
 æœ€åæˆ‘ä»¬åº”è¯¥å°†custom viewæ”¾åˆ°menu itemä¸­ï¼Œåœ¨onCreateOptionsMenu()ä¸­ï¼š
```java
 @Override
public boolean onCreateOptionsMenu(Menu menu) {
    getMenuInflater().inflate(R.menu.menu_main, menu);
    inboxMenuItem = menu.findItem(R.id.action_inbox);
    inboxMenuItem.setActionView(R.layout.menu_item_view);
    return true;
}
```
ä»¥ä¸Šå°±æ˜¯toolbarçš„æ‰€æœ‰ä¸œè¥¿ã€‚å¹¶ä¸”onClickçš„æŒ‰ä¸‹æ•ˆæœä¹Ÿè¾¾åˆ°äº†é¢„æœŸçš„æ•ˆæœï¼š

![](http://jcodecraeer.com/uploads/20150204/1423059085109860.png)

#Feed
æœ€åéœ€è¦å®ç°çš„æ˜¯feedï¼ŒåŸºäºRecyclerViewå®ç°ã€‚æˆ‘ä»¬éœ€è¦è®¾ç½®ä¸¤ä¸ªä¸œè¥¿ï¼šlayout managerå’Œadapterï¼Œå› ä¸ºè¿™é‡Œå…¶å®å°±æ˜¯æƒ³å®ç°ListViewçš„æ•ˆæœï¼Œæ‰€ä»¥ç›´æ¥ç”¨LinearLayoutManagerå°±è¡Œäº†ï¼Œè€Œadapteræˆ‘ä»¬é¦–å…ˆä»itemçš„å¸ƒå±€å¼€å§‹(res/layout/item_feed.xml)ï¼š

item_feed.xml

```xml
<?xml version="1.0" encoding="utf-8"?><!-- item_feed.xml -->
<android.support.v7.widget.CardView xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:card_view="http://schemas.android.com/apk/res-auto"
    android:id="@+id/card_view"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:layout_gravity="center"
    android:layout_margin="8dp"
    card_view:cardCornerRadius="4dp">
  
    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="vertical">
      
        <ImageView
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:src="@drawable/ic_feed_top" />
          
        <io.github.froger.instamaterial.SquaredImageView
            android:id="@+id/ivFeedCenter"
            android:layout_width="match_parent"
            android:layout_height="wrap_content" />
          
        <ImageView
            android:id="@+id/ivFeedBottom"
            android:layout_width="match_parent"
            android:layout_height="wrap_content" />
      
    </LinearLayout>
</android.support.v7.widget.CardView>
```
FeedAdapterä¹Ÿéå¸¸ç®€å•ï¼š

FeedAdapter.java
```java
public class FeedAdapter extends RecyclerView.Adapter<RecyclerView.ViewHolder> {
    private static final int ANIMATED_ITEMS_COUNT = 2;
      
    private Context context;
    private int lastAnimatedPosition = -1;
    private int itemsCount = 0;
      
    public FeedAdapter(Context context) {
        this.context = context;
    }
      
    @Override
    public RecyclerView.ViewHolder onCreateViewHolder(ViewGroup parent, int viewType) {
        final View view = LayoutInflater.from(context).inflate(R.layout.item_feed, parent, false);
        return new CellFeedViewHolder(view);
    }
      
    private void runEnterAnimation(View view, int position) {
        if (position >= ANIMATED_ITEMS_COUNT - 1) {
            return;
        }
          
        if (position > lastAnimatedPosition) {
            lastAnimatedPosition = position;
            view.setTranslationY(Utils.getScreenHeight(context));
            view.animate()
            .translationY(0)
            .setInterpolator(new DecelerateInterpolator(3.f))
            .setDuration(700)
            .start();
        }
    }
      
    @Override
    public void onBindViewHolder(RecyclerView.ViewHolder viewHolder, int position) {
        runEnterAnimation(viewHolder.itemView, position);
        CellFeedViewHolder holder = (CellFeedViewHolder) viewHolder;
        if (position % 2 == 0) {
            holder.ivFeedCenter.setImageResource(R.drawable.img_feed_center_1);
            holder.ivFeedBottom.setImageResource(R.drawable.img_feed_bottom_1);
        } else {
            holder.ivFeedCenter.setImageResource(R.drawable.img_feed_center_2);
            holder.ivFeedBottom.setImageResource(R.drawable.img_feed_bottom_2);
        }
    }
      
    @Override
    public int getItemCount() {
        return itemsCount;
    }
      
    public static class CellFeedViewHolder extends RecyclerView.ViewHolder {
        @InjectView(R.id.ivFeedCenter)
        SquaredImageView ivFeedCenter;
        @InjectView(R.id.ivFeedBottom)
        ImageView ivFeedBottom;
          
        public CellFeedViewHolder(View view) {
        super(view);
            ButterKnife.inject(this, view);
        }
    }
      
    public void updateItems() {
        itemsCount = 10;
        notifyDataSetChanged();
    }
}
```
æ²¡ä»€ä¹ˆç‰¹åˆ«ä¹‹å¤„éœ€è¦è¯´æ˜ã€‚

é€šè¿‡ä»¥ä¸‹æ–¹æ³•å°†ä»–ä»¬æ”¾åœ¨ä¸€èµ·ï¼š
```java
private void setupFeed() {
    LinearLayoutManager linearLayoutManager = new LinearLayoutManager(this);
    rvFeed.setLayoutManager(linearLayoutManager);
    feedAdapter = new FeedAdapter(this);
    rvFeed.setAdapter(feedAdapter);
}
```
ä¸‹é¢æ˜¯æ•´ä¸ªMainActivity classçš„æºç ï¼š
//MainActivity.java
```java
public class MainActivity extends ActionBarActivity {
    @InjectView(R.id.toolbar)
    Toolbar toolbar;
    @InjectView(R.id.rvFeed)
    RecyclerView rvFeed;
      
    private MenuItem inboxMenuItem;
    private FeedAdapter feedAdapter;
      
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        ButterKnife.inject(this);
          
        setupToolbar();
        setupFeed();
    }
      
    private void setupToolbar() {
        setSupportActionBar(toolbar);
        toolbar.setNavigationIcon(R.drawable.ic_menu_white);
    }
      
    private void setupFeed() {
        LinearLayoutManager linearLayoutManager = new LinearLayoutManager(this);
        rvFeed.setLayoutManager(linearLayoutManager);
        feedAdapter = new FeedAdapter(this);
        rvFeed.setAdapter(feedAdapter);
    }
      
    @Override
    public boolean onCreateOptionsMenu(Menu menu) {
        getMenuInflater().inflate(R.menu.menu_main, menu);
        inboxMenuItem = menu.findItem(R.id.action_inbox);
        inboxMenuItem.setActionView(R.layout.menu_item_view);
        return true;
    }
}

```
è¿è¡Œç»“æœï¼š

Android Lollipop

![](http://jcodecraeer.com/uploads/20150204/1423059086107717.png)


Android pre-21

![](http://jcodecraeer.com/uploads/20150204/1423059082492283.png)

##åŠ¨ç”»

æœ€åä¸€ä»¶ä¹Ÿæ˜¯æœ€é‡è¦çš„äº‹æƒ…å°±æ˜¯è¿›å…¥æ—¶çš„åŠ¨ç”»æ•ˆæœï¼Œå†æµè§ˆä¸€éæ¦‚å¿µè§†é¢‘ï¼Œå¯ä»¥å‘ç°åœ¨main Activityå¯åŠ¨çš„æ—¶å€™æœ‰å¦‚ä¸‹åŠ¨ç”»ï¼Œåˆ†æˆä¸¤æ­¥ï¼š


æ˜¾ç¤ºToolbarä»¥åŠå…¶é‡Œé¢çš„å…ƒç´ 

åœ¨ToolbaråŠ¨ç”»å®Œæˆä¹‹åæ˜¾ç¤ºfeedå’Œfloating action buttonã€‚

Toolbarä¸­å…ƒç´ çš„åŠ¨ç”»è¡¨ç°ä¸ºåœ¨è¾ƒçŸ­çš„æ—¶é—´å†…ä¸€ä¸ªæ¥ä¸€ä¸ªçš„è¿›å…¥ã€‚å®ç°è¿™ä¸ªæ•ˆæœçš„ä¸»è¦é—®é¢˜åœ¨äºnavigation iconçš„åŠ¨ç”»ï¼Œnavigation iconæ˜¯å”¯ä¸€ä¸€ä¸ªä¸èƒ½ä½¿ç”¨åŠ¨ç”»çš„ï¼Œå…¶ä»–çš„éƒ½å¥½åŠã€‚
*Toolbar animation*

é¦–å…ˆæˆ‘ä»¬åªæ˜¯éœ€è¦åœ¨activityå¯åŠ¨çš„æ—¶å€™æ‰æ’­æ”¾åŠ¨ç”»ï¼ˆåœ¨æ—‹è½¬å±å¹•çš„æ—¶å€™ä¸æ’­æ”¾ï¼‰ï¼Œè¿˜è¦çŸ¥é“menuçš„åŠ¨ç”»è¿‡ç¨‹æ˜¯ä¸èƒ½åœ¨onCreate()ä¸­å»å®ç°çš„ï¼ˆæˆ‘ä»¬åœ¨onCreateOptionsMenu()ä¸­å®ç°ï¼‰ï¼Œåˆ›å»ºä¸€ä¸ªå¸ƒå°”ç±»å‹çš„å˜é‡pendingIntroAnimation ï¼Œåœ¨onCreate()æ–¹æ³•ä¸­åˆå§‹åŒ–ï¼š
```java
//...
if (savedInstanceState == null) {
    pendingIntroAnimation = true;
}
```
onCreateOptionsMenu():
```java
@Override
public boolean onCreateOptionsMenu(Menu menu) {
    getMenuInflater().inflate(R.menu.menu_main, menu);
    inboxMenuItem = menu.findItem(R.id.action_inbox);
    inboxMenuItem.setActionView(R.layout.menu_item_view);
    if (pendingIntroAnimation) {
        pendingIntroAnimation = false;
        startIntroAnimation();
    }
    return true;
}
```
è¿™æ ·startIntroAnimation()å°†åªè¢«è°ƒç”¨ä¸€æ¬¡ã€‚

ç°åœ¨è¯¥æ¥å‡†å¤‡Toolbarä¸­å…ƒç´ çš„åŠ¨ç”»äº†ï¼Œä¹Ÿéå¸¸ç®€å•

ToolbarAnimation
```java
//...
private static final int ANIM_DURATION_TOOLBAR = 300;
  
private void startIntroAnimation() {
    btnCreate.setTranslationY(2 * getResources().getDimensionPixelOffset(R.dimen.btn_fab_size));
    int actionbarSize = Utils.dpToPx(56);
    toolbar.setTranslationY(-actionbarSize);
    ivLogo.setTranslationY(-actionbarSize);
    inboxMenuItem.getActionView().setTranslationY(-actionbarSize);
      
    toolbar.animate()
        .translationY(0)
        .setDuration(ANIM_DURATION_TOOLBAR)
        .setStartDelay(300);
    ivLogo.animate()
        .translationY(0)
        .setDuration(ANIM_DURATION_TOOLBAR)
        .setStartDelay(400);
    inboxMenuItem.getActionView().animate()
        .translationY(0)
        .setDuration(ANIM_DURATION_TOOLBAR)
        .setStartDelay(500)
        .setListener(new AnimatorListenerAdapter() {
            @Override
            public void onAnimationEnd(Animator animation) {
            startContentAnimation();
            }
        })
        .start();
}
//...
```
åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼š

    é¦–å…ˆæˆ‘ä»¬å°†æ‰€æœ‰çš„å…ƒç´ éƒ½é€šè¿‡ç§»åŠ¨åˆ°å±å¹•ä¹‹å¤–éšè—èµ·æ¥ï¼ˆè¿™ä¸€æ­¥æˆ‘ä»¬å°†FABä¹Ÿéšè—äº†ï¼‰ã€‚

    è®©Toolbarå…ƒç´ ä¸€ä¸ªæ¥ä¸€ä¸ªçš„å¼€å§‹åŠ¨ç”»

    å½“åŠ¨ç”»å®Œæˆï¼Œè°ƒç”¨äº†startContentAnimation()å¼€å§‹contentçš„åŠ¨ç”»ï¼ˆFABå’Œfeedå¡ç‰‡çš„åŠ¨ç”»ï¼‰

 ç®€å•ï¼Œæ˜¯å§ï¼Ÿ
*Content åŠ¨ç”»*

åœ¨è¿™ä¸€æ­¥ä¸­æˆ‘ä»¬å°†è®©FABå’Œfeedå¡ç‰‡åŠ¨èµ·æ¥ã€‚FABçš„åŠ¨ç”»å¾ˆç®€å•ï¼Œè·Ÿä¸Šé¢çš„æ–¹æ³•ç±»ä¼¼ï¼Œä½†æ˜¯feedå¡ç‰‡ç¨å¾®å¤æ‚äº›ã€‚

startContentAnimationæ–¹æ³•
```java
//...
//FAB animation
private static final int ANIM_DURATION_FAB = 400;
  
private void startContentAnimation() {
    btnCreate.animate()
        .translationY(0)
        .setInterpolator(new OvershootInterpolator(1.f))
        .setStartDelay(300)
        .setDuration(ANIM_DURATION_FAB)
        .start();
    feedAdapter.updateItems();
}
//...
```
FeedAdapterçš„ä»£ç åœ¨ä¸Šé¢å·²ç»è´´å‡ºæ¥äº†ã€‚ç»“åˆç€å°±çŸ¥é“åŠ¨ç”»æ˜¯å¦‚ä½•å®ç°çš„äº†ã€‚


æœ¬ç¯‡æ–‡ç« å°±ç»“æŸäº†ï¼Œé¿å…é—æ¼ï¼Œè¿™é‡Œæ˜¯è¿™ç¯‡æ–‡ç« æ˜¯æäº¤çš„ä»£ç  [commit for our project with implemented animations](https://github.com/frogermcs/InstaMaterial/commit/4e838861c5f858711b1072777cae2325ce12ee21) .

 
##æºä»£ç 

å®Œæ•´çš„ä»£ç åœ¨[Github repository](https://github.com/frogermcs/InstaMaterial).

ä½œè€…: Miroslaw Stanek
